<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ–ãƒ©ã‚¦ã‚¶RPGï¼ˆä¿®æ­£ç‰ˆï¼‰</title>
    <style>
        body,html{margin:0;padding:0;height:100%;font-family:Arial,sans-serif;background-color:#f0f0f0}
        #game-container{display:flex;flex-direction:column;height:100%;max-width:800px;margin:0 auto;background-color:white;box-shadow:0 0 10px rgba(0,0,0,0.1)}
        h1{text-align:center;padding:10px;margin:0;background-color:#4CAF50;color:white}
        #game-area{display:flex;flex:1;overflow:hidden}
        #map-container{flex:2;overflow:auto;position:relative}
        #map{display:grid;grid-template-columns:repeat(15,1fr);gap:1px;background-color:#ccc;padding:1px}
        .cell{aspect-ratio:1;display:flex;justify-content:center;align-items:center;font-size:2vw;background-color:#8fbc8f}
        .wall{background-color:#a0522d}
        #info-panel{flex:1;padding:10px;overflow-y:auto;display:flex;flex-direction:column}
        #status,#message{margin-bottom:10px}
        #actions{display:flex;flex-wrap:wrap;justify-content:center}
        button{margin:5px;padding:10px;font-size:16px}
        #enemy-display{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background-color:rgba(0,0,0,0.7);padding:20px;border-radius:10px;display:none;text-align:center}
        #enemy-image{font-size:8vw;margin-bottom:10px}
        #enemy-name{color:white;font-size:2vw;margin-bottom:10px}
        @media (max-width:600px){#game-area{flex-direction:column}.cell{font-size:5vw}#enemy-image{font-size:20vw}#enemy-name{font-size:6vw}}
    </style>
</head>
<body>
    <div id="game-container">
        <h1>ãƒ–ãƒ©ã‚¦ã‚¶RPGï¼ˆä¿®æ­£ç‰ˆï¼‰</h1>
        <div id="game-area">
            <div id="map-container">
                <div id="map"></div>
                <div id="enemy-display">
                    <div id="enemy-image"></div>
                    <div id="enemy-name"></div>
                </div>
            </div>
            <div id="info-panel">
                <div id="status"></div>
                <div id="message"></div>
                <div id="actions"></div>
            </div>
        </div>
    </div>
    <script>
        const player={name:"å‹‡è€…",hp:100,maxHp:100,attack:10,defense:5,magic:5,gold:0,exp:0,level:1,x:0,y:0};
        const baseMonsters=[
            {name:"ã‚¹ãƒ©ã‚¤ãƒ ",hp:20,attack:5,defense:2,exp:10,gold:10,icon:'ğŸ§Š'},
            {name:"ã‚´ãƒ–ãƒªãƒ³",hp:30,attack:8,defense:3,exp:15,gold:15,icon:'ğŸ‘º'},
            {name:"ã‚ªãƒ¼ã‚¯",hp:50,attack:12,defense:5,exp:25,gold:25,icon:'ğŸ‘½'}
        ];
        const baseBosses=[
            {name:"ãƒ‰ãƒ©ã‚´ãƒ³",hp:100,attack:20,defense:10,exp:100,gold:100,icon:'ğŸ‰'},
            {name:"ãƒ‡ãƒ¼ãƒ¢ãƒ³",hp:150,attack:25,defense:15,exp:150,gold:150,icon:'ğŸ˜ˆ'},
            {name:"é­”ç‹",hp:200,attack:30,defense:20,exp:200,gold:200,icon:'ğŸ¦¹'}
        ];
        const icons={player:'ğŸ§™',floor:'ã€€',wall:'ğŸ§±',chest:'ğŸ',boss:'ğŸ‘¹'};
        let currentMonster=null,map=[],stage=1,chestsCollected=0,totalChests=5;
        const mapSize=15;

        function initMap(){
            map=Array(mapSize).fill().map(()=>Array(mapSize).fill('wall'));
            generateMaze(1,1);
            chestsCollected=0;
            for(let i=0;i<totalChests;i++)placeItem('chest');
            placeItem('player');
            renderMap();
        }

        function generateMaze(x,y){
            const directions=[[0,-1],[1,0],[0,1],[-1,0]].sort(()=>Math.random()-0.5);
            map[y][x]='floor';
            for(let [dx,dy] of directions){
                let nx=x+dx*2,ny=y+dy*2;
                if(nx>0&&nx<mapSize-1&&ny>0&&ny<mapSize-1&&map[ny][nx]==='wall'){
                    map[y+dy][x+dx]='floor';
                    generateMaze(nx,ny);
                }
            }
        }

        function placeItem(item){
            let x,y;
            do{x=Math.floor(Math.random()*mapSize);y=Math.floor(Math.random()*mapSize)}
            while(map[y][x]!=='floor');
            if(item==='player'){player.x=x;player.y=y}else{map[y][x]=item}
        }

        function renderMap(){
            document.getElementById("map").innerHTML=map.map((row,y)=>row.map((cell,x)=>`<div class="cell ${cell}">${x===player.x&&y===player.y?icons.player:icons[cell]}</div>`).join('')).join('');
        }

        function movePlayer(dx,dy){
            const newX=player.x+dx,newY=player.y+dy;
            if(newX>=0&&newX<mapSize&&newY>=0&&newY<mapSize&&map[newY][newX]!=='wall'){
                player.x=newX;player.y=newY;
                renderMap();
                if(map[player.y][player.x]==='chest'){
                    const gold=Math.floor(Math.random()*50)+10;
                    player.gold+=gold;map[player.y][player.x]='floor';chestsCollected++;
                    showMessage(`å®ç®±ã‚’è¦‹ã¤ã‘ãŸï¼${gold}ã‚´ãƒ¼ãƒ«ãƒ‰ã‚’æ‰‹ã«å…¥ã‚ŒãŸï¼`);
                    if(chestsCollected===totalChests)spawnBoss();
                }else if(map[player.y][player.x]==='boss'){
                    startBattle(true);
                }else if(Math.random()<0.2){
                    startBattle(false);
                }else{
                    showMessage("å®‰å…¨ã«ç§»å‹•ã—ã¾ã—ãŸã€‚");
                    showMovementActions();
                }
            }else{
                showMessage("ãã“ã«ã¯è¡Œã‘ã¾ã›ã‚“ã€‚");
                showMovementActions();
            }
            updateStatus();
        }

        function spawnBoss(){
            currentMonster={...baseBosses[stage-1]};
            scaleEnemy(currentMonster);
            placeItem('boss');
            showMessage(`å…¨ã¦ã®å®ç®±ã‚’è¦‹ã¤ã‘ãŸï¼${currentMonster.name}ãŒç¾ã‚ŒãŸï¼`);
            renderMap();
        }

        function updateStatus(){
            document.getElementById("status").innerHTML=`ã‚¹ãƒ†ãƒ¼ã‚¸: ${stage} | ${player.name} - ãƒ¬ãƒ™ãƒ«: ${player.level} | HP: ${player.hp}/${player.maxHp} | æ”»æ’ƒåŠ›: ${player.attack} | é˜²å¾¡åŠ›: ${player.defense} | é­”åŠ›: ${player.magic} | çµŒé¨“å€¤: ${player.exp} | ã‚´ãƒ¼ãƒ«ãƒ‰: ${player.gold} | å®ç®±: ${chestsCollected}/${totalChests}`;
        }

        function showMessage(msg){document.getElementById("message").innerHTML=msg;}

        function showActions(actions){
            const actionsDiv = document.getElementById("actions");
            actionsDiv.innerHTML = '';
            actions.forEach(action => {
                const button = document.createElement('button');
                button.textContent = action.text;
                button.addEventListener('click', action.onClick);
                actionsDiv.appendChild(button);
            });
        }

        function showMovementActions(){
            showActions([
                {text:"â†‘",onClick:()=>movePlayer(0,-1)},
                {text:"â†“",onClick:()=>movePlayer(0,1)},
                {text:"â†",onClick:()=>movePlayer(-1,0)},
                {text:"â†’",onClick:()=>movePlayer(1,0)},
                {text:"ä¼‘æ†©",onClick:rest}
            ]);
        }

        function scaleEnemy(enemy){
            const scaleFactor=1+(stage-1)*0.2;
            for(let key in enemy)if(typeof enemy[key]==='number')enemy[key]=Math.floor(enemy[key]*scaleFactor);
        }

        function startBattle(isBoss=false){
            if (isBoss && currentMonster) {
                // ãƒœã‚¹æˆ¦ã®å ´åˆã€currentMonsterã¯æ—¢ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã¯ãš
            } else {
                currentMonster = {...baseMonsters[Math.floor(Math.random()*baseMonsters.length)]};
                if (!isBoss) scaleEnemy(currentMonster);
            }
            showMessage(`${currentMonster.name}ãŒç¾ã‚ŒãŸï¼`);
            showBattleActions(isBoss);
            displayEnemy(currentMonster);
        }

        function displayEnemy(enemy){
            const display=document.getElementById('enemy-display');
            display.innerHTML=`<div id="enemy-image">${enemy.icon}</div><div id="enemy-name">${enemy.name}</div>`;
            display.style.display='block';
        }

        function showBattleActions(isBoss){
            showActions([
                {text:"æ”»æ’ƒ",onClick:()=>battle(isBoss,"attack")},
                {text:"é­”æ³•",onClick:()=>battle(isBoss,"magic")},
                {text:"é€ƒã’ã‚‹",onClick:()=>flee(isBoss)}
            ]);
        }

        function battle(isBoss,type){
            if (!currentMonster) return;
            const damage=type==="magic"?Math.floor(player.magic*2*(0.8+Math.random()*0.4)):Math.max(1,player.attack-currentMonster.defense);
            currentMonster.hp-=damage;
            showMessage(`${player.name}ã®${type==="magic"?"é­”æ³•æ”»æ’ƒ":"æ”»æ’ƒ"}ï¼${currentMonster.name}ã«${damage}ã®ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`);
            checkBattleResult(isBoss);
        }

        function checkBattleResult(isBoss){
            if (!currentMonster) return;
            if(currentMonster.hp<=0){
                player.gold+=currentMonster.gold;
                player.exp+=currentMonster.exp;
                showMessage(`${currentMonster.name}ã‚’å€’ã—ãŸï¼${currentMonster.gold}ã‚´ãƒ¼ãƒ«ãƒ‰ã¨${currentMonster.exp}çµŒé¨“å€¤ã‚’ç²å¾—ï¼`);
                checkLevelUp();
                document.getElementById('enemy-display').style.display='none';
                if(isBoss){
                    completeStage();
                } else {
                    currentMonster = null;
                    showMovementActions();
                }
            }else{
                const damage=Math.max(1,currentMonster.attack-player.defense);
                player.hp-=damage;
                showMessage(`${currentMonster.name}ã®æ”»æ’ƒï¼${player.name}ã¯${damage}ã®ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’å—ã‘ãŸï¼`);
                if(player.hp<=0){
                    gameOver();
                }else{
                    showBattleActions(isBoss);
                }
            }
            updateStatus();
        }

        function completeStage(){
            stage++;
            showMessage(`ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¯ãƒªã‚¢ï¼æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã«é€²ã¿ã¾ã™ã€‚`);
            if(stage>baseBosses.length){
                gameOver();
            } else {
                initMap();
                showMovementActions();
            }
        }

        function checkLevelUp(){
            if(player.exp>=player.level*20){
                player.level++;player.maxHp+=10;player.hp=player.maxHp;
                player.attack+=2;player.defense+=1;player.magic+=1;player.exp=0;
                showMessage(`ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼ãƒ¬ãƒ™ãƒ«${player.level}ã«ãªã£ãŸï¼`);
                updateStatus();
            }
        }

        function flee(isBoss){
            if(isBoss){
                showMessage("ãƒœã‚¹ã‹ã‚‰ã¯é€ƒã’ã‚‰ã‚Œãªã„ï¼");
                showBattleActions(true);
            }else if(Math.random()<0.5){
                showMessage("ç„¡äº‹ã«é€ƒã’å‡ºã—ãŸï¼");
                document.getElementById('enemy-display').style.display='none';
                currentMonster = null;
                showMovementActions();
            }else{
                showMessage("é€ƒã’ã‚‰ã‚Œãªã‹ã£ãŸï¼");
                const damage=Math.max(1,currentMonster.attack-player.defense);
                player.hp-=damage;
                showMessage(`${currentMonster.name}ã®æ”»æ’ƒï¼${player.name}ã¯${damage}ã®ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’å—ã‘ãŸï¼`);
                if(player.hp<=0){
                    gameOver();
                }else{
                    showBattleActions(false);
                }
            }
            updateStatus();
        }

        function rest(){
            if(player.gold>=10){
                player.gold-=10;player.hp=player.maxHp;
                showMessage("å…¨å›å¾©ã—ã¾ã—ãŸï¼");
            }else{
                showMessage("ã‚´ãƒ¼ãƒ«ãƒ‰ãŒè¶³ã‚Šã¾ã›ã‚“ï¼");
            }
            updateStatus();
            showMovementActions();
        }

        function gameOver(){
            document.getElementById('enemy-display').style.display='none';
            showMessage(stage>baseBosses.length?"ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼å…¨ã¦ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸï¼":"ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼...");
            showActions([{text:"æœ€åˆã‹ã‚‰",onClick:init}]);
        }

        function init(){
            Object.assign(player,{hp:100,maxHp:100,attack:10,defense:5,magic:5,gold:0,exp:0,level:1});
            stage=1;
            initMap();
            updateStatus();
            showMessage("å†’é™ºã‚’å§‹ã‚ã¾ã—ã‚‡ã†ï¼");
            showMovementActions();
        }

        init();
    </script>
</body>
</html>
